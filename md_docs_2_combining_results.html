<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fp: Combining Result&lt;T&gt;s</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">fp
   </div>
   <div id="projectbrief">FP (Functional Programming) extensions for C++</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Combining Result&lt;T&gt;s </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial will show you how to write functions that combine Result&lt;T&gt;s. A common reason for this is you are building a struct and the construction of the various operations you do to build that struct could fail. One common place where you might write code like this is when loading ROS parameters.</p>
<h1><a class="anchor" id="autotoc_md44"></a>
Calling the functions that can fail</h1>
<p>For this example lets assume we have a function that loads ros parameters with this interface.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line">Result&lt;T&gt; load_parameter(std::string <span class="keyword">const</span>&amp; name, T default_value);</div>
</div><!-- fragment --><p>And you have a struct that represents your parameters that you'd like to load.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Parameters {</div>
<div class="line">  std::string input_topic = <span class="stringliteral">&quot;input&quot;</span>;</div>
<div class="line">  std::string output_topic = <span class="stringliteral">&quot;output&quot;</span>;</div>
<div class="line">  <span class="keywordtype">double</span> rate = 100.0;</div>
<div class="line">};</div>
</div><!-- fragment --><p>The function we want to write will have this signature:</p>
<div class="fragment"><div class="line">Result&lt;Parameters&gt; load_parameters();</div>
</div><!-- fragment --><p>The first we will do in our function is load our three values.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> <span class="keyword">const</span> default_values = Parameters{};</div>
<div class="line"><span class="keyword">auto</span> <span class="keyword">const</span> input_topic = load_parameter(<span class="stringliteral">&quot;input_topic&quot;</span>, default_values.input_topic);</div>
<div class="line"><span class="keyword">auto</span> <span class="keyword">const</span> output_topic = load_parameter(<span class="stringliteral">&quot;output_topic&quot;</span>, default_values.output_topic);</div>
<div class="line"><span class="keyword">auto</span> <span class="keyword">const</span> rate = load_parameter(<span class="stringliteral">&quot;rate&quot;</span>, default_values.rate);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md45"></a>
Testing if any of them failed</h2>
<p>Next we need to check if any of these failed before we can construct the result. To do this we use the helper function <code><a class="el" href="namespacefp.html#ae6161b2ffcda278db444bcd60c6764b4">fp::maybe_error</a></code>.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span>(<span class="keyword">auto</span> <span class="keyword">const</span> error = <a class="code" href="namespacefp.html#ae6161b2ffcda278db444bcd60c6764b4">fp::maybe_error</a>(input_topic, output_topic, rate); error) {</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="namespacetl.html#a01de1a0282a693451af969f35e88bcf9">tl::make_unexpected</a>(error.value());</div>
<div class="line">}</div>
</div><!-- fragment --><p>In this case the <code>error</code> variable is a <code>std::optional&lt;<a class="el" href="structfp_1_1Error.html" title="Error type used by Result&lt;T&gt;">fp::Error</a>&gt;</code> which means that if it contains a value of type <code><a class="el" href="structfp_1_1Error.html" title="Error type used by Result&lt;T&gt;">fp::Error</a></code> it will be <code>true</code> when cast to bool. The statement inside the if statement is needed to create a <code>Result&lt;Parameters&gt;</code> type containing the error that we received.</p>
<h2><a class="anchor" id="autotoc_md46"></a>
Using the valid results</h2>
<p>Now that we are past that if statement we know that all our results are valid and we can use them to construct the <code>Parameters</code> struct.</p>
<div class="fragment"><div class="line"><span class="keywordflow">return</span> Parameters{*input_topic, *output_topic, *rate};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md47"></a>
Summary</h1>
<p>In this tutorial you learned about a convenience function <code><a class="el" href="namespacefp.html#ae6161b2ffcda278db444bcd60c6764b4">fp::maybe_error</a></code> you can use to check many results before using them.</p>
<h1><a class="anchor" id="autotoc_md48"></a>
Next Tutorial</h1>
<p><a class="el" href="md_docs_3_chaining_functions.html">Chaining functions that return Result&lt;T&gt;</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="anamespacefp_html_ae6161b2ffcda278db444bcd60c6764b4"><div class="ttname"><a href="namespacefp.html#ae6161b2ffcda278db444bcd60c6764b4">fp::maybe_error</a></div><div class="ttdeci">constexpr std::optional&lt; E &gt; maybe_error(tl::expected&lt; Args, E &gt;... args)</div><div class="ttdef"><b>Definition:</b> <a href="result_8hpp_source.html#l00227">result.hpp:227</a></div></div>
<div class="ttc" id="anamespacetl_html_a01de1a0282a693451af969f35e88bcf9"><div class="ttname"><a href="namespacetl.html#a01de1a0282a693451af969f35e88bcf9">tl::make_unexpected</a></div><div class="ttdeci">unexpected&lt; typename std::decay&lt; E &gt;::type &gt; make_unexpected(E &amp;&amp;e)</div><div class="ttdef"><b>Definition:</b> <a href="expected_8hpp_source.html#l00178">expected.hpp:178</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
